<!-- Header vacío/transparente solo para Safe Area -->
<ion-header class="ion-no-border header-transparente">
  <ion-toolbar>
  </ion-toolbar>
</ion-header>

<ion-content class="gourmet-content">
  <div class="form-container">
    
    <!-- Header Interno (Dentro del contenedor) -->
    <div class="inner-header">
      <ion-buttons>
        <ion-back-button defaultHref="/home" mode="md" class="custom-back-btn"></ion-back-button>
      </ion-buttons>
      <h1 class="inner-title">Alta Usuario</h1>
    </div>

    <!-- FOTO SECTION -->
    <div class="foto-section">
      <div class="avatar-wrapper" [class.has-error]="fotoError">
        @if (foto?.url) {
          <img [src]="foto?.url" class="avatar-img" alt="Foto perfil">
          <ion-button class="btn-delete-photo" color="danger" shape="round" (click)="eliminarFoto()">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-button>
        } @else {
          <div class="avatar-placeholder" (click)="tomarFoto()">
            <ion-icon name="camera"></ion-icon>
            <span>Foto</span>
          </div>
        }
      </div>
      @if (fotoError) {
        <ion-text color="danger" class="error-text-center">
          <small>{{ fotoError }}</small>
        </ion-text>
      }
    </div>

    <form [formGroup]="empleadoForm" (ngSubmit)="agregarEmpleado()">
      
      <!-- SCANNER BUTTON -->
      <ion-button expand="block" class="btn-scan mb-4" (click)="escanearDNI()">
        <ion-icon name="scan" slot="start"></ion-icon>
        Escanear DNI
      </ion-button>

      <!-- PERSONAL DATA CARD -->
      <div class="gourmet-card">
        <h3 class="section-title">Datos Personales</h3>
        
        <ion-item class="gourmet-input">
          <ion-label position="floating">Nombre</ion-label>
          <ion-input type="text" formControlName="nombre"></ion-input>
          <ion-note slot="error" *ngIf="nombreError">{{ nombreError }}</ion-note>
        </ion-item>

        <ion-item class="gourmet-input">
          <ion-label position="floating">Apellido</ion-label>
          <ion-input type="text" formControlName="apellido"></ion-input>
          <ion-note slot="error" *ngIf="apellidoError">{{ apellidoError }}</ion-note>
        </ion-item>

        <ion-item class="gourmet-input">
          <ion-label position="floating">DNI</ion-label>
          <ion-input type="number" formControlName="dni"></ion-input>
          <ion-note slot="error" *ngIf="dniError">{{ dniError }}</ion-note>
        </ion-item>

        <ion-item class="gourmet-input">
          <ion-label position="floating">CUIL</ion-label>
          <ion-input type="text" formControlName="cuil"></ion-input>
          <ion-note slot="error" *ngIf="cuilError">{{ cuilError }}</ion-note>
        </ion-item>
      </div>

      <!-- ACCOUNT DATA CARD -->
      <div class="gourmet-card">
        <h3 class="section-title">Datos de Cuenta</h3>

        <ion-item class="gourmet-input">
          <ion-label position="floating">Email</ion-label>
          <ion-input type="email" formControlName="email"></ion-input>
          <ion-note slot="error" *ngIf="emailError">{{ emailError }}</ion-note>
        </ion-item>

        <ion-item class="gourmet-input">
          <ion-label position="floating">Contraseña</ion-label>
          <ion-input type="password" formControlName="contrasenia"></ion-input>
        </ion-item>

        <ion-item class="gourmet-input">
          <ion-label position="floating">Perfil</ion-label>
          <ion-select formControlName="perfil" interface="action-sheet" cancelText="Cancelar">
            @for (perfil of perfilesDisponibles; track perfil) {
              <ion-select-option [value]="perfil">{{ perfil | titlecase }}</ion-select-option>
            }
          </ion-select>
        </ion-item>
      </div>

      <ion-button type="submit" expand="block" class="btn-gourmet-primary mt-4" [disabled]="empleadoForm.invalid">
        <ion-icon name="save" slot="start"></ion-icon>
        Registrar
      </ion-button>

    </form>
  </div>
</ion-content>