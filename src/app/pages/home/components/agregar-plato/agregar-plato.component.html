<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Agregar Nuevo Plato</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <!-- Overlay de loading -->
  @if (isLoading) {
    <div class="loading-overlay">
      <div class="loading-content">
        <ion-spinner name="crescent" color="primary"></ion-spinner>
        <p>{{ loadingMessage }}</p>
      </div>
    </div>
  }

  <div class="agregar-plato-container">
    
    <ion-card>
      <ion-card-content>
        
        <ion-item fill="outline">
          <ion-label position="floating">Nombre del Plato</ion-label>
          <ion-input 
            type="text"
            [(ngModel)]="nombre"
            [disabled]="isLoading"
            maxlength="100">
          </ion-input>
        </ion-item>

        <ion-item fill="outline">
          <ion-label position="floating">Descripción</ion-label>
          <ion-textarea
            [(ngModel)]="descripcion"
            [disabled]="isLoading"
            rows="4"
            maxlength="500"
            autoGrow="true">
          </ion-textarea>
        </ion-item>

        <ion-item fill="outline">
          <ion-label position="floating">Tiempo de Elaboración (minutos)</ion-label>
          <ion-input 
            type="number"
            [(ngModel)]="tiempoElaboracion"
            [disabled]="isLoading"
            min="1"
            max="1440">
          </ion-input>
        </ion-item>

        <ion-item fill="outline">
          <ion-label position="floating">Precio</ion-label>
          <ion-input 
            type="number"
            [(ngModel)]="precio"
            [disabled]="isLoading"
            min="0.01"
            step="0.01">
          </ion-input>
        </ion-item>

      </ion-card-content>
    </ion-card>

    <ion-card>
      <ion-card-content>
        <h2>Fotos del Plato</h2>
        
        <ion-grid>
          <ion-row>
            @for (foto of fotos; track $index) {
              <ion-col size="4">
                <div class="foto-preview">
                  <img [src]="foto.url" alt="Foto del plato">
                  <ion-button 
                    size="small" 
                    color="danger" 
                    fill="clear"
                    [disabled]="isLoading"
                    (click)="eliminarFoto($index)">
                    <ion-icon name="close-circle"></ion-icon>
                  </ion-button>
                </div>
              </ion-col>
            }
          </ion-row>
        </ion-grid>

        @if (fotos.length < 3) {
          <div class="foto-buttons">
            <ion-button 
              expand="block"
              fill="outline"
              [disabled]="isLoading"
              (click)="agregarFoto('camera')">
              <ion-icon name="camera" slot="start"></ion-icon>
              Tomar Foto
            </ion-button>

            <ion-button 
              expand="block"
              fill="outline"
              [disabled]="isLoading"
              (click)="agregarFoto('gallery')">
              <ion-icon name="images" slot="start"></ion-icon>
              Galería
            </ion-button>
          </div>
        }
      </ion-card-content>
    </ion-card>

    <div class="action-buttons">
      <ion-button 
        expand="block"
        size="large"
        color="primary"
        [disabled]="isLoading"
        (click)="guardarPlato()">
        <ion-icon name="save" slot="start"></ion-icon>
        Agregar Plato
      </ion-button>
    </div>

  </div>
</ion-content>