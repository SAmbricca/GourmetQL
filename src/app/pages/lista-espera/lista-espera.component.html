<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="volverAlHome()">
        <ion-icon name="arrow-back" class="header-icon"></ion-icon>
      </ion-button>
    </ion-buttons>
    
    <ion-title class="ion-text-center app-title">
      Lista de Espera
    </ion-title>

    <ion-buttons slot="end">
      <ion-button (click)="cerrarSesion()">
        <ion-icon name="log-out-outline" class="header-icon"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content 
      pullingIcon="chevron-down-circle-outline"
      refreshingSpinner="crescent">
    </ion-refresher-content>
  </ion-refresher>

  <div class="listas-container">
    
    <div class="seccion-lista">
      <div class="seccion-header">
        <ion-icon name="people"></ion-icon>
        <h2>Clientes Registrados</h2>
      </div>

      @if (cargando) {
        <div class="loading-state">
          <ion-spinner name="crescent"></ion-spinner>
          <p>Cargando lista...</p>
        </div>
      } @else if (clientesEnEspera.length === 0) {
        <div class="empty-state">
          <ion-icon name="clipboard-outline"></ion-icon>
          <p>No hay clientes registrados en espera</p>
        </div>
      } @else {
        <ion-grid>
          <ion-row>
            @for (item of clientesEnEspera; track item.id) {
              <ion-col size="12" size-md="6">
                <ion-card class="cliente-card registrado">
                  <ion-card-header>
                    <div class="cliente-header">
                      <div class="header-top">
                        <ion-card-title>{{ obtenerNombreCliente(item) }}</ion-card-title>
                        <ion-badge color="gold">Registrado</ion-badge>
                      </div>
                      <div class="tiempo-info">
                        <ion-icon name="time-outline"></ion-icon>
                        <small>Ingreso: {{ formatearHora(item.fecha_ingreso) }}</small>
                      </div>
                    </div>
                  </ion-card-header>
                  
                  <ion-card-content>
                    <div class="acciones-botones">
                      @if (mesaSeleccionadaId !== item.id) {
                        <ion-button 
                          expand="block" 
                          class="btn-asignar"
                          (click)="mostrarInputMesa(item.id)">
                          Asignar Mesa
                        </ion-button>
                      } @else {
                        <div class="input-mesa-container">
                          <input 
                            #inputMesa
                            type="number" 
                            class="input-numero-mesa"
                            placeholder="Mesa #"
                            min="1"
                            [(ngModel)]="numeroMesaInput"
                            (keyup.enter)="confirmarAsignacion(item.id, false)">
                          
                          <div class="botones-confirmacion">
                            <ion-button 
                              class="btn-confirmar"
                              (click)="confirmarAsignacion(item.id, false)">
                              <ion-icon name="checkmark"></ion-icon>
                            </ion-button>
                            <ion-button 
                              class="btn-cancelar"
                              (click)="cancelarAsignacion()">
                              <ion-icon name="close"></ion-icon>
                            </ion-button>
                          </div>
                        </div>
                      }
                    </div>
                  </ion-card-content>
                </ion-card>
              </ion-col>
            }
          </ion-row>
        </ion-grid>
      }
    </div>

    <div class="separator-ornament"></div>

    <div class="seccion-lista">
      <div class="seccion-header">
        <ion-icon name="person-circle-outline"></ion-icon>
        <h2>Clientes Anónimos</h2>
      </div>

      @if (cargando) {
         } @else if (clientesAnonimosEnEspera.length === 0) {
        <div class="empty-state">
          <ion-icon name="glasses-outline"></ion-icon>
          <p>No hay anónimos en espera</p>
        </div>
      } @else {
        <ion-grid>
          <ion-row>
            @for (item of clientesAnonimosEnEspera; track item.id) {
              <ion-col size="12" size-md="6">
                <ion-card class="cliente-card anonimo">
                  <ion-card-header>
                    <div class="cliente-header">
                      <div class="header-top">
                         <div class="nombre-container">
                            <ion-card-title>{{ obtenerNombreCliente(item) }}</ion-card-title>
                            <ion-badge color="medium">Anónimo</ion-badge>
                         </div>
                      </div>
                      <div class="tiempo-info">
                        <ion-icon name="time-outline"></ion-icon>
                        <small>Ingreso: {{ formatearHora(item.fecha_ingreso) }}</small>
                      </div>
                    </div>
                  </ion-card-header>
                  
                  <ion-card-content>
                    <div class="acciones-botones">
                      @if (mesaSeleccionadaId !== item.id) {
                        <ion-button 
                          expand="block" 
                          class="btn-asignar"
                          (click)="mostrarInputMesa(item.id)">
                          Asignar Mesa
                        </ion-button>
                      } @else {
                        <div class="input-mesa-container">
                          <input 
                            #inputMesa
                            type="number" 
                            class="input-numero-mesa"
                            placeholder="Mesa #"
                            min="1"
                            [(ngModel)]="numeroMesaInput"
                            (keyup.enter)="confirmarAsignacion(item.id, true)">
                          
                          <div class="botones-confirmacion">
                            <ion-button 
                              class="btn-confirmar"
                              (click)="confirmarAsignacion(item.id, true)">
                              <ion-icon name="checkmark"></ion-icon>
                            </ion-button>
                            <ion-button 
                              class="btn-cancelar"
                              (click)="cancelarAsignacion()">
                              <ion-icon name="close"></ion-icon>
                            </ion-button>
                          </div>
                        </div>
                      }
                    </div>
                  </ion-card-content>
                </ion-card>
              </ion-col>
            }
          </ion-row>
        </ion-grid>
      }
    </div>

  </div>
</ion-content>